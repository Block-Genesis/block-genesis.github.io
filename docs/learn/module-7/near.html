<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">NEAR | Block Genesis</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://block-genesis.github.io//docs/learn/module-7/near"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="NEAR | Block Genesis"><meta data-react-helmet="true" name="description" content="NEAR Protocol is a public blockchain and smart contract platform built to host high-throughput decentralized applications. It uses an sharding to scale the network and improve the overall user experience. NEAR, of the same name, is the native currency that holders can use to pay the costs associated with deploying applications or submitting transactions. The NEAR token also plays a central role in the platform&#x27;s Proof-of-Stake consensus mechanism, where participants can stake tokens on the network to increase its cost of attack. Similar to Ethereum, the concept of gas is also used to pay for computation and mitigate spam. Accounts also pay storage rent which accumulates over time and is charged once the account submits a transaction for processing. Storage rent is charged for data and also as a tax on short account names to discourage name squatting."><meta data-react-helmet="true" property="og:description" content="NEAR Protocol is a public blockchain and smart contract platform built to host high-throughput decentralized applications. It uses an sharding to scale the network and improve the overall user experience. NEAR, of the same name, is the native currency that holders can use to pay the costs associated with deploying applications or submitting transactions. The NEAR token also plays a central role in the platform&#x27;s Proof-of-Stake consensus mechanism, where participants can stake tokens on the network to increase its cost of attack. Similar to Ethereum, the concept of gas is also used to pay for computation and mitigate spam. Accounts also pay storage rent which accumulates over time and is charged once the account submits a transaction for processing. Storage rent is charged for data and also as a tax on short account names to discourage name squatting."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://block-genesis.github.io//docs/learn/module-7/near"><link data-react-helmet="true" rel="alternate" href="https://block-genesis.github.io//docs/learn/module-7/near" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://block-genesis.github.io//docs/learn/module-7/near" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cde0eb83.css">
<link rel="preload" href="/assets/js/runtime~main.304edd76.js" as="script">
<link rel="preload" href="/assets/js/main.0844afbe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-title.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo-title.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link" href="/docs/start/intro">Start</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/learn/getting-started">üìñ Learn</a><a class="navbar__item navbar__link" href="/docs/buidl/overview">üõ†Ô∏è Buidl</a><a class="navbar__item navbar__link" href="/docs/explore/intro">üåê Explore</a><a class="navbar__item navbar__link" href="/docs/earn/intro">Earn</a><a class="navbar__item navbar__link" href="/docs/resources/intro">Resources</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-1/basic-cryptography">Module 1 - Blockchain ELI5</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-2/traditional-finance">Module 2 - Financial Systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-3/trustless-computing">Module 3 - Web3</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-4/code-is-law">Module 4 - Smart Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-5/tokenomics">Module 5 - Crypto-economics and Game Theory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-6/scalability-trilemma">Module 6 - Scalability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/learn/module-7/consensus-mechanisms">Module 7 - Blockchain Wars</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/consensus-mechanisms">Consensus Mechanisms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/bitcoin">Bitcoin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/monero">Monero</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/ethereum">Ethereum</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/bnbchain">BNBChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/solana">Solana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/polkadot">Polkadot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/cosmos">Cosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/learn/module-7/near">NEAR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/avalanche">Avalanche</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/fantom">Fantom</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/other-blockchains">Other Blockchains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/learn/module-7/bridging">Bridging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://docs.google.com/presentation/d/1iF2iVo_g5daJAvgf1kP14TEzw9MXsO2ZJPHfHN80qNw/" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>üî• Fireside Chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/learn/module-8/useful-proof-of-work">Module 8 - Problems and Challenges</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="theme-doc-markdown markdown"><h1>NEAR</h1><p>NEAR Protocol is a public blockchain and smart contract platform built to host high-throughput decentralized applications. It uses an sharding to scale the network and improve the overall user experience. NEAR, of the same name, is the native currency that holders can use to pay the costs associated with deploying applications or submitting transactions. The NEAR token also plays a central role in the platform&#x27;s Proof-of-Stake consensus mechanism, where participants can stake tokens on the network to increase its cost of attack. Similar to Ethereum, the concept of gas is also used to pay for computation and mitigate spam. Accounts also pay storage rent which accumulates over time and is charged once the account submits a transaction for processing. Storage rent is charged for data and also as a tax on short account names to discourage name squatting.</p><p>In a block, transactions are split into chunks, one chunk per shard. A block is the accumulation of all chunks. Chunks are validated by nodes that maintain the state of that shard. Each logical block will theoretically contain all transactions for all shards. Each network participant maintains the state that corresponds to the shards that they validate transactions for and any additional shard that they want to track, since transmitting a logical block across the network would be expensive.</p><p>For consensus, once a block producer publishes a block, they collect the signatures of the validator nodes, then the weight of a block is determined by the cumulative stake of all the signers whose signatures are included in the block. Thus, consensus is based on the heaviest chain, as the weight of a chain is the sum of the block weights. Additionally, the consensus utilizes the Nightshade Finality Gadget, which introduces additional slashing conditions for higher chain security.</p><p><strong>Block Explorer</strong>: <a href="https://explorer.near.org/" target="_blank" rel="noopener noreferrer">https://explorer.near.org/</a></p><p><strong>Addresses</strong>: Uses readable account IDs instead of a hash of a public key. Account IDs contain a minimum length of 2 with maximum length of 64. Account ID consists of Account ID parts separated by &quot;.&quot; and each part consists of lowercase alphanumeric symbols separated by either _ or -. Example: <code>blockgenesis.near</code></p><p><strong>Consensus</strong>: Sharded Proof-of-Stake with blocks constructed with a gadget called Doomslug and a slower finality gadget called Nightshade Finality Gadget.</p><p><strong>NEAR Supply</strong>: No hard cap on the total supply.</p><p><strong>Smart Contracts</strong>: Contracts compile down to WebAssembly (.wasm), which is a binary instruction format for a stack-based virtual machine, that are run on a WebAssembly virtual machine. You can therefore use any language that can compile to wasm, but the recommended to use is Rust.</p><p>Example contract code:</p><div class="codeBlockContainer_I0IT language-rust theme-code-block"><div class="codeBlockContent_wNvx rust"><pre tabindex="0" class="prism-code language-rust codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* Fungible Token implementation with JSON serialization.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* NOTES:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  - The maximum balance value is limited by U128 (2**128 - 1).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  - JSON calls should pass U128 as a base-10 string. E.g. &quot;100&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  - The contract optimizes the inner trie structure by hashing account IDs. It will prevent some</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*    abuse of deep tries. Shouldn&#x27;t be an issue, once NEAR clients implement full hashing of keys.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  - This contract doesn&#x27;t optimize the amount of storage, since any account can create unlimited</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*    amount of allowances to other accounts. It&#x27;s unclear how to address this issue unless, this</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*    contract limits the total number of different allowances possible at the same time.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*    And even if it limits the total number, it&#x27;s still possible to transfer small amounts to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*    multiple accounts.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use borsh::{BorshDeserialize, BorshSerialize};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use near_sdk::collections::Map;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use near_sdk::json_types::U128;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use near_sdk::{env, near_bindgen, AccountId, Balance};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[global_allocator]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Contains balance and allowances information for one account.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(BorshDeserialize, BorshSerialize)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Account {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Current account balance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub balance: Balance,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Escrow Account ID hash to the allowance amount.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Allowance is the amount of tokens the Escrow Account ID can spent on behalf of the account</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// owner.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub allowances: Map&lt;Vec&lt;u8&gt;, Balance&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl Account {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Initializes a new Account with 0 balance and no allowances for a given `account_hash`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn new(account_hash: Vec&lt;u8&gt;) -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            balance: 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            allowances: Map::new(account_hash),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Sets allowance for account `escrow_account_id` to `allowance`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn set_allowance(&amp;mut self, escrow_account_id: &amp;AccountId, allowance: Balance) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let escrow_hash = env::sha256(escrow_account_id.as_bytes());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if allowance &gt; 0 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.allowances.insert(&amp;escrow_hash, &amp;allowance);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.allowances.remove(&amp;escrow_hash);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Returns the allowance of account `escrow_account_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn get_allowance(&amp;self, escrow_account_id: &amp;AccountId) -&gt; Balance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let escrow_hash = env::sha256(escrow_account_id.as_bytes());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.allowances.get(&amp;escrow_hash).unwrap_or(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Contains balance and allowances information for one account.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(BorshDeserialize, BorshSerialize)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Account {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Current account balance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub balance: Balance,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Escrow Account ID hash to the allowance amount.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Allowance is the amount of tokens the Escrow Account ID can spent on behalf of the account</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// owner.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub allowances: Map&lt;Vec&lt;u8&gt;, Balance&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl Account {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Initializes a new Account with 0 balance and no allowances for a given `account_hash`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn new(account_hash: Vec&lt;u8&gt;) -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            balance: 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            allowances: Map::new(account_hash),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Sets allowance for account `escrow_account_id` to `allowance`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn set_allowance(&amp;mut self, escrow_account_id: &amp;AccountId, allowance: Balance) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let escrow_hash = env::sha256(escrow_account_id.as_bytes());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if allowance &gt; 0 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.allowances.insert(&amp;escrow_hash, &amp;allowance);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.allowances.remove(&amp;escrow_hash);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Returns the allowance of account `escrow_account_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn get_allowance(&amp;self, escrow_account_id: &amp;AccountId) -&gt; Balance {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let escrow_hash = env::sha256(escrow_account_id.as_bytes());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.allowances.get(&amp;escrow_hash).unwrap_or(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[near_bindgen]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(BorshDeserialize, BorshSerialize)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct FungibleToken {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// sha256(AccountID) -&gt; Account details.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub accounts: Map&lt;Vec&lt;u8&gt;, Account&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Total supply of the all token.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub total_supply: Balance,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl Default for FungibleToken {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn default() -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        panic!(&quot;Fun token should be initialized before usage&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[near_bindgen]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl FungibleToken {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Initializes the contract with the given total supply owned by the given `owner_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[init]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn new(owner_id: AccountId, total_supply: U128) -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let total_supply = total_supply.into();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        assert!(env::state_read::&lt;Self&gt;().is_none(), &quot;Already initialized&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut ft = Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            accounts: Map::new(b&quot;a&quot;.to_vec()),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            total_supply,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut account = ft.get_account(&amp;owner_id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        account.balance = total_supply;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ft.set_account(&amp;owner_id, &amp;account);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ft</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Sets the `allowance` for `escrow_account_id` on the account of the caller of this contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// (`predecessor_id`) who is the balance owner.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn set_allowance(&amp;mut self, escrow_account_id: AccountId, allowance: U128) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let allowance = allowance.into();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let owner_id = env::predecessor_account_id();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if escrow_account_id == owner_id {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            env::panic(b&quot;Can&#x27;t set allowance for yourself&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut account = self.get_account(&amp;owner_id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        account.set_allowance(&amp;escrow_account_id, allowance);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.set_account(&amp;owner_id, &amp;account);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Transfers the `amount` of tokens from `owner_id` to the `new_owner_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Requirements:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// * `amount` should be a positive integer.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// * `owner_id` should have balance on the account greater or equal than the transfer `amount`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// * If this function is called by an escrow account (`owner_id != predecessor_account_id`),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///   then the allowance of the caller of the function (`predecessor_account_id`) on</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///   the account of `owner_id` should be greater or equal than the transfer `amount`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn transfer_from(&amp;mut self, owner_id: AccountId, new_owner_id: AccountId, amount: U128) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let amount = amount.into();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if amount == 0 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            env::panic(b&quot;Can&#x27;t transfer 0 tokens&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Retrieving the account from the state.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut account = self.get_account(&amp;owner_id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Checking and updating unlocked balance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if account.balance &lt; amount {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            env::panic(b&quot;Not enough balance&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        account.balance -= amount;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // If transferring by escrow, need to check and update allowance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let escrow_account_id = env::predecessor_account_id();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if escrow_account_id != owner_id {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let allowance = account.get_allowance(&amp;escrow_account_id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if allowance &lt; amount {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                env::panic(b&quot;Not enough allowance&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            account.set_allowance(&amp;escrow_account_id, allowance - amount);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Saving the account back to the state.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.set_account(&amp;owner_id, &amp;account);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Deposit amount to the new owner and save the new account to the state.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut new_account = self.get_account(&amp;new_owner_id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new_account.balance += amount;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.set_account(&amp;new_owner_id, &amp;new_account);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Transfer `amount` of tokens from the caller of the contract (`predecessor_id`) to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// `new_owner_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Act the same was as `transfer_from` with `owner_id` equal to the caller of the contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// (`predecessor_id`).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn transfer(&amp;mut self, new_owner_id: AccountId, amount: U128) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.transfer_from(env::predecessor_account_id(), new_owner_id, amount);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Returns total supply of tokens.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn get_total_supply(&amp;self) -&gt; U128 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.total_supply.into()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Returns balance of the `owner_id` account.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn get_balance(&amp;self, owner_id: AccountId) -&gt; U128 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_account(&amp;owner_id).balance.into()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Returns current allowance of `escrow_account_id` for the account of `owner_id`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// NOTE: Other contracts should not rely on this information, because by the moment a contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// receives this information, the allowance may already be changed by the owner.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// So this method should only be used on the front-end to see the current allowance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn get_allowance(&amp;self, owner_id: AccountId, escrow_account_id: AccountId) -&gt; U128 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_account(&amp;owner_id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .get_allowance(&amp;escrow_account_id)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .into()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/learn/module-7/cosmos"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cosmos</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/learn/module-7/avalanche"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Avalanche</div></a></div></nav></div></div></div></div></main></div></div><footer class="footer footerPadding_WXgF"><div class="container"><div class="row footerRow_lyqe"><div class="col col--2 col--offset-1"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://pendle.finance" target="_blank" rel="noopener noreferrer" class="footerLogoLink_fGS1"><img src="/img/logo.svg" alt="Pendle Finance Logo" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/img/logo.svg" alt="Pendle Finance Logo" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></a></div></div></div><div class="col col--4 col--offset-3"><div class="row footer__links footerColumn_QUx7"><div class="col footer__col"><div class="footer__title">Pages</div><ul class="footer__items"><li class="footer__item"><a href="https://pendle.finance" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website</span></a></li><li class="footer__item"><a href="https://app.pendle.finance" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>App</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/EAujvncY2R/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord</span></a></li><li class="footer__item"><a href="https://twitter.com/pendle_fi/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li><li class="footer__item"><a href="https://t.me/pendlefinance/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram</span></a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/pendle/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Medium</span></a></li><li class="footer__item"><a href="https://angel.co/company/pendle_finance/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Careers</span></a></li><li class="footer__item"><a href="https://pendle.finance/Pendle_Media_Kit.zip" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Media Kit</span></a></li><li class="footer__item"><a href="https://github.com/pendle-finance/pendle-core/tree/master/docs/audits" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Audits</span></a></li></ul></div></div></div><div class="footer__copyright">Copyright ¬© 2022 Pendle Finance</div></div></div></footer></div>
<script src="/assets/js/runtime~main.304edd76.js"></script>
<script src="/assets/js/main.0844afbe.js"></script>
</body>
</html>